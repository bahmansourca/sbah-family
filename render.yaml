services:
  # Service principal - Site statique
  - type: static
    name: sbah-family-frontend
    env: static
    buildCommand: cd sbah-app-v2 && echo "Static site ready"
    staticPublishPath: ./sbah-app-v2
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    headers:
      - path: /*
        name: Cache-Control
        value: "no-cache"
      - path: /*.js
        name: Cache-Control
        value: "no-cache"
      - path: /*.css
        name: Cache-Control
        value: "no-cache"
      - path: /*.png
        name: Cache-Control
        value: "public, max-age=31536000"
      - path: /*.jpg
        name: Cache-Control
        value: "public, max-age=31536000"
    envVars:
      - key: NODE_VERSION
        value: 16.x

  # Service pour les fonctions serverless (webhook PayDunya)
  - type: web
    name: sbah-family-api
    env: node
    buildCommand: cd functions && npm install
    startCommand: node functions/server.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: "10000"
